# URL 인코딩

> ### :date: 날짜: 2023-10-18

> ### :question: 의문점
> 
> 자료를 찾다가 유용한 블로그 글을 참고하기 위해 주소를 복사하는 경우가 있다. velog는 특히, 주소를 복사할 때, 인코딩 돼서 불편했다. velog 주소를 복사하고, 인코딩 된 주소를 붙여 넣고, 인코딩된 주소를 복사하고 다시 붙여넣으면 원하는 페이지로 가지 않는다..  그래서, URL 인코딩에 대해 궁금해져서 관련 자료를 찾아보고자 했다. 

<br>

> ### URL 인코딩이 뭡니까?

- URL에서 URL로 사용할 수 없는 문자를 '%XX'와 같은 형태로 변환하는 것을 말합니다. 여기서, '%XX'에서 'XX'는 16진수로 표현이 됩니다. 

<br>

> ### URL 인코딩을 하는 이유

1. **다양한 문자열 표현**
- 일반적으로, 영어만 사용할 때는 URL이 인코딩되지 않는다. 영어는 그대로 들어가지만, 한글이나, 일본어, 중국어 등 다양한 언어를 표현하기 위해 문자 인코딩이 탄생했고, 이를 특정한 규칙에 따라 변환을 해주는 것이다.

<br>

2. **데이터 표현**
- URL 인코딩을 하는 이유는 기본적으로 URL은 ASCII 문자 집합으로 구성되어야 한다는 규칙이 있기 때문이다.
  
  <img title="" src="https://postfiles.pstatic.net/MjAxODA5MTNfNzQg/MDAxNTM2ODQ1MzkxMDg4.nXavaWWTKIBfM4OE-gXCFgK43TGrW--b8BwvuQnHJscg.YnKCmxZj8jzP5a6FgZygASg5-_w400wF8KBvvD7vUZ4g.PNG.bbmobile/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7_2018-09-13_%EC%98%A4%ED%9B%84_10.29.15.png?type=w966" alt="" width="209" data-align="center">
  
  -> 그래서, 데이터를 전송할 때, ASCII 문자 집합 내에 있는 문자로 표현해야 하기 때문에, 1차적으로 URL 인코딩을 해주는 것이다. 
  
  ASCII 문자 집합에 포함된 영어, 숫자, 특수 기호, 예약된 문자 등만 URL에 포함될 수 있기 때문에, ASCII 문자 집합에 포함되지 않는 한글, 중국어, 일본어는 따로 인코딩을 해서 URL에 집어넣어 주는 것이다.
  
  - ASCII 문자 집합 이미지
  
  <img title="" src="https://blog.kakaocdn.net/dn/qOPNt/btrAdcY26CF/Ksn1qKzUqEaCql1Cbk6GG0/img.png" alt="" width="321" data-align="center">

그렇다면, ASCII코드로 표현할 수 있는 문자로 인코딩되었는데, 한글은 저기에 없는데 무슨 기준으로 문자를 변환하는 건지 의문이 들 수 있다. 앞서 말한 것과 같이, ASCII 문자 집합은 한글, 중국어 등 다양한 언어를 표현할 수 없기 때문에, 국제 표준으로 UTF-8이라는 인코딩 방식을 사용한다. 

<br>

> ### UTF-8 인코딩 원리

- 유니코드는 ASCII 문자 집합이 다양한 문자를 표현할 수 없는 한계 등으로 더 다양한 문자를 인코딩할 수 있게 해주는 표준 방식이다. 이 중, UTF-8이라는 인코딩 방식이 대중적으로 사용되고 있다. 

- UTF-8은 다양한 문자를 모아두고, 해당 문자에 해당하는 코드를 대응시켜 인코딩하는 방식입니다.

- 아래는 UTF-8의 유니코드 표 중 일부이다.

- UTF-8 유니코드 표

<img title="" src="https://postfiles.pstatic.net/MjAxODA5MTRfMTAw/MDAxNTM2OTExODA3NjA2.uiBpxDliIW7C0UR9lihtZElLLE1vwEGkkRSdVKjIkJcg.smD_Ltx6CdCzSWZ_aJGK2qGiDZeUHoPkKmXqfafhKK0g.PNG.bbmobile/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7_2018-09-14_%EC%98%A4%ED%9B%84_4.55.50.png?type=w966" alt="" width="357" data-align="center">

- 위 그림과 같이 한글 글자마다 대응하는 코드가 있다. "가"라는 한글은 UTF-8에서 AC00이라는 코드와 대응되고, U+AC00이라는 유니코드로 표현한다. "AC00"을 코드포인트라고 하고, U+는 유니코드라는 뜻이다.

![](https://postfiles.pstatic.net/MjAxODA5MTdfMTg1/MDAxNTM3MTg0OTI2NjQ5.dcxKkeXRsWL3j3gAOxivz8yqexyxN7szijPifObaDZAg.dX1aKwNTo-hip6DK9RjkT6n_9SMxcRZSHSUGxvIoK08g.PNG.bbmobile/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7_2018-09-17_%EC%98%A4%ED%9B%84_8.48.27.png?type=w966)

- **UTF-8 인코딩의 규칙성**
  
  - "가"라는 것을 유니코드로 변환하면 U+AC00이다. 이것의 코드포인트인 AC00는 16진수로 표현된 것이고, 이를 2진수로 표현하면 "1010(A) 1100(C) 0000(0) 0000(0)이다.
  
  - AC00의 코드포인트는 위의 표에따라, 3byte크기에 해당하는 문자열이기 때문에, 인코딩 방법에 의하면 1110xxxx 10xxxxxx 10xxxxxx와 같은 형식으로 인코딩이 되는데, 위에서 AC00을 2진수로 표현된 1010 1100 0000 0000을 x로 표시된 부분에 순서대로 넣게 되면 11101010 10110000 10000000 과 같은 이진수로 나타나게 되고, 이를 16진수로 변환하면 EA B0 80의 16진수가 된다.
  
  -> 따라서, "가"라는 문자를 UTF-8방식으로 인코딩하게 되면 **EA B0 80**으로 나타나게 되고, **URL에서는 %EA%B0%80 으로 변하게 된다.** 여기서 %는 16진수끼리 구분하기 위한 구분자 역할을 한다고 생각하면 된다.

- **왜 이런 규칙을 갖게 된 것일까?**
  
  - "가"는 AC00의 코드포인트를 갖고 있고, 위의 범위에 따라 1110xxxx 10xxxxxx 10xxxxxx 과 같은 형태로 인코딩 되는데 왜 이런 방식으로 인코딩을 하는 것인지 의문을 갖게 되었다.
  
  - 위에서 2byte에 해당하는 코드포인트 범위는 0080 ~ 07FF다. 범위의 각 끝을 담당하는 0080과 07FF를 2진수로 변환한 값은 다음과 같다.
  
  - 0080 -> 0000 0000 1000 0000
  
  - 07FF -> 0000 0111 1111 1111
  
  - 앞에 0을 생략하면 0080은 8자리로 표현 가능하고, 07FF는 11자리로 표현이 가능하다. 
  
  - 1Byte로 표현한 범위는 2진수로 표현될 때, 1~7자리수, 2Byte는 8자리 ~11자리, 3Byte는 12자리 ~ 16자리로 표현될 수 있다.
  
  - 이를 볼 때, 코드포인트의 자리 수에 따라, 구분을 했고, 앞에 붙는 110, 1110은 유니코드 범위에 따른 규칙성을 나타내기 위한 임의의 규칙이라고 생각이 된다.

<br>

URL 인코딩에서는 ASCII 문자 집합에 포함되어 있음에도, 특수한 상황에서, utf-8 규칙에 의해 인코딩 되는 경우가 있다. 바로 **예약된 문자**다.

> ### 예약된 문자가 뭡니까?

- URL에서 기능적으로 작동하는 문자를 말한다.

- 예약된 문자들 -> ":", "/", "?", "#", "[", "]" 등 더 많은 예약된 문자가 있다.
  
  - **콜론 (:)**: 콜론은 URI에서 스키마와 나머지 부분을 구분하는 역할을 한다. 예를 들어, "http://"나 "https://"와 같은 스키마를 나타내는 부분에서 콜론을 사용한다.
  
  - **슬래시 (/)**: 슬래시는 URI의 경로를 구분하는 데 사용된다. 예를 들어, "[https://www.example.com/path/to/resource"에서](https://www.example.com/path/to/resource%22%EC%97%90%EC%84%9C) 슬래시는 경로를 구분한다.
  
  - **앤드 기호 (&)**: 앤드 기호는 쿼리 문자열 내에서 다양한 매개변수를 구분하는 데 사용된다. 다수의 키와 값의 조합을 구별한다.
  
  - 이 외적으로 많은 예약된 문자가 있고, URL내에서 특정 기능으로 작동한다.
  
  - 하지만, 예약된 문자를 기능적으로 안쓰고 단순한 문자열로 사용하고 싶은 경우가 있다.**"https://ganjisriver.tistory.com/피그&돼지"** 같은 url 예시를 들면, 마지막 "피그&돼지"는 쿼리 문자열 구분을 위한 기능이 아니라, 단순한 문자열로 사용된 것이기 때문에, &도 utf-8로 인코딩된다.

- 즉, 예약된 문자로 사용될 때는 인코딩하지 않고, 예약된 문자로 사용하지 않고, 그 문자열 자체로 사용된 것 같을 때, utf-8로 인코딩된다.

<br>

> ### 정리

1. URL에서 한글, 중국어 등이 인코딩 되는 이유
- URL에서는 ASCII 문자 집합에 해당하는 문자만 포함할 수 있기 때문에, UTF-8이라는 문자열 인코딩 방식을 통해 ASCII 문자 집합에 포함되는 16진수로 변환해준다.
2. UTF-8 원리
- 다양한 언어를 표현할 수 없는 ASCII 문자 집합의 한계를 넘기 위해 유니코드, 그 중에서도 UTF-8을 사용하여 인코딩하는 것이 국제 표준이다.
3. 예약된 문자
- ASCII 문자 집합에 포함된 문자열도, url에서 기능으로 사용되는 경우가 있기 때문에, 예약된 문자로 분류되는 문자가 기능이 아닌 단순히 문자열을 나타낼 때 사용될 경우는 인코딩 된다.

<br>

> ### 참고 자료

[[Web] URL 인코딩/디코딩 (URL Encoding/Decoding)](https://it-eldorado.tistory.com/143) - URL 인코딩/디코딩 이해가 잘되게 설명해주심.

[유니피커 봄봄오피스 블로그 : 네이버 블로그](https://blog.naver.com/bbmobile/221360230141) - 유니코드, UTF-8에 대해 잘 설명해주심
